<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–§–æ—Ç–æ –ø—Ä–∏ –∑–∞—Ö–æ–¥–µ</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 2em;
      background: #f9f9f9;
    }
    video, canvas, img {
      max-width: 100%;
      border-radius: 1em;
      margin: 1em 0;
    }
    button {
      font-size: 1.2em;
      padding: 0.5em 1em;
      border: none;
      background: #0084ff;
      color: white;
      border-radius: 0.5em;
      cursor: pointer;
    }
    button:hover {
      background: #005fc1;
    }
    #status {
      margin-top: 1em;
      color: green;
    }
  </style>
</head>
<body>
  <h1>–ü—Ä–∏–≤–µ—Ç! –£–ª—ã–±–Ω–∏—Å—å üòÑ</h1>
  <video id="video" autoplay playsinline width="400"></video>
  <br>
  <button id="snap">–°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ</button>
  <canvas id="canvas" style="display: none;"></canvas>
  <p id="status"></p>

  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const snapBtn = document.getElementById('snap');
    const status = document.getElementById('status');

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ–º –≤–∏–¥–µ–æ
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => video.srcObject = stream)
      .catch(err => status.textContent = '–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ: ' + err);

    snapBtn.onclick = () => {
      const ctx = canvas.getContext('2d');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.drawImage(video, 0, 0);
      const dataUrl = canvas.toDataURL('image/png');

      status.textContent = '–°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–æ—Ç–æ...';

      fetch('/.netlify/functions/save-photo', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ image: dataUrl })
      })
      .then(res => res.text())
      .then(link => {
        status.innerHTML = '–§–æ—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ: <a href="' + link + '">' + link + '</a>';
        window.location.href = link;
      })
      .catch(err => status.textContent = '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + err);
    };
  </script>
</body>
</html>
